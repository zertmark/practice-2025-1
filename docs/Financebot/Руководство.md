# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ Telegram-–±–æ—Ç–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–ª–∞–¥–æ–º –∏ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏

---

## üóÇÔ∏è –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)  
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)  
3. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](#Ô∏è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Å—Ä–µ–¥—ã-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)  
4. [–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)  
5. [–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π](#-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-–æ—Å–Ω–æ–≤–Ω—ã—Ö-–º–æ–¥—É–ª–µ–π)  
6. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram API](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-telegram-api)  
7. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)  
8. [–î–µ–ø–ª–æ–π](#-–¥–µ–ø–ª–æ–π)  
---

## –í–≤–µ–¥–µ–Ω–∏–µ
–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî —Å–æ–∑–¥–∞—Ç—å Telegram-–±–æ—Ç–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É—á–µ—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.  
**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:  
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥—Å–∫–∏–º–∏ –æ—Å—Ç–∞—Ç–∫–∞–º–∏  
- –†–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏ –∏ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏  
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ –≤ Excel  
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π  

```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] --> B[Telegram Bot]
    B --> C[–°–∫–ª–∞–¥—Å–∫–æ–π –º–æ–¥—É–ª—å]
    B --> D[–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –º–æ–¥—É–ª—å]
    C --> E[–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite]
    D --> E
    E --> F[Excel-–æ—Ç—á–µ—Ç—ã]
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] <--> B[Telegram API]
    B <--> C[FinanceBot.py]
    C <--> D[MessageHandler]
    D <--> E[Stack Module]
    D <--> F[Finance Module]
    E <--> G[(Stack DB)]
    F <--> H[(Finance DB)]
    D <--> I[ExcelWriter]
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
1. –°–∫–∞—á–∞–π—Ç–µ [Python 3.10+](https://www.python.org/downloads/)
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/Mac
   venv\Scripts\activate.bat  # Windows
   ```
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
   ```bash
   pip install python-telegram-bot==20.0 sqlite3 xlsxwriter
   ```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫:
```
project/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îú‚îÄ‚îÄ config.py
‚îî‚îÄ‚îÄ requirements.txt
```

## –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### ER-–¥–∏–∞–≥—Ä–∞–º–º–∞
```mermaid
erDiagram
    STACK ||--o{ SALES : "–∏–º–µ–µ—Ç"
    STACK {
        int product_id PK
        varchar(255) name
        int remaining
        decimal cost
        decimal revenue
    }

    FINANCE {
        int month_id PK
        varchar(50) period
        decimal plan
        decimal actual
    }
```

### SQL-—Å–∫—Ä–∏–ø—Ç—ã
1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `STACK`:
   ```sql
   CREATE TABLE STACK (
       product_id INTEGER PRIMARY KEY AUTOINCREMENT,
       name TEXT NOT NULL,
       remaining INTEGER DEFAULT 0,
       cost DECIMAL(10,2),
       revenue DECIMAL(10,2)
   );
   ```
2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `FINANCE`:
   ```sql
   CREATE TABLE FINANCE (
       month_id INTEGER PRIMARY KEY AUTOINCREMENT,
       period VARCHAR(50) UNIQUE,
       plan DECIMAL(10,2),
       actual DECIMAL(10,2)
   );
   ```


## üíª –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π

### 1. –ú–æ–¥—É–ª—å —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (database/core.py)
```python
import sqlite3

class Database:
    def __init__(self, db_path: str):
        self.connection = sqlite3.connect(db_path)
        self.cursor = self.connection.cursor()
    
    def execute(self, query: str, params: tuple = None):
        try:
            self.cursor.execute(query, params or ())
            self.connection.commit()
            return self.cursor.fetchall()
        except sqlite3.Error as e:
            print(f"Database error: {e}")
```

### 2. –°–∫–ª–∞–¥—Å–∫–æ–π –º–æ–¥—É–ª—å (handlers/stack.py)
**–ü—Ä–∏–º–µ—Ä –º–µ—Ç–æ–¥–∞ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞**:
```python
def sell_product(self, product_id: int, quantity: int) -> bool:
    current = self.db.execute("SELECT remaining FROM STACK WHERE product_id=?", (product_id,))
    if not current or current[0][0] < quantity:
        return False
    
    self.db.execute("UPDATE STACK SET remaining = remaining - ? WHERE product_id=?", (quantity, product_id))
    return True
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram API

### –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```mermaid
sequenceDiagram
    participant User
    participant Bot
    participant Handler
    participant Database
    
    User->>Bot: /sell 42 3
    Bot->>Handler: parse_command()
    Handler->>Database: check_availability(42, 3)
    Database-->>Handler: True
    Handler->>Database: update_stock(42, -3)
    Handler->>Database: add_profit(42, 3)
    Bot-->>User: "–£—Å–ø–µ—à–Ω–æ –ø—Ä–æ–¥–∞–Ω–æ 3 —à—Ç."
```

### –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã (bot/handlers/main.py)
```python
from telegram import Update
from telegram.ext import CommandHandler

def sell_handler(update: Update, context):
    args = context.args
    if len(args) != 2:
        update.message.reply_text("–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: /sell <ID> <–∫–æ–ª-–≤–æ>")
        return
    
    product_id = int(args[0])
    quantity = int(args[1])
    
    if stack_manager.sell_product(product_id, quantity):
        update.message.reply_text(f"–ü—Ä–æ–¥–∞–Ω–æ {quantity} —à—Ç. —Ç–æ–≤–∞—Ä–∞ {product_id}")
    else:
        update.message.reply_text("–û—à–∏–±–∫–∞: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞")
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–∞–±–ª–∏—Ü–∞ —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤
| –¢–µ—Å—Ç-–∫–µ–π—Å | –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|----------------|---------------------|--------|
| –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ | `/add Book 100 50` | –¢–æ–≤–∞—Ä –≤ –ë–î | ‚úÖ |
| –ü—Ä–æ–¥–∞–∂–∞ —Ç–æ–≤–∞—Ä–∞ | `/sell 1 10` | –û—Å—Ç–∞—Ç–æ–∫ —É–º–µ–Ω—å—à–µ–Ω | ‚úÖ |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ | `/report stock` | –§–∞–π–ª stock.xlsx | ‚úÖ |

### –ü—Ä–∏–º–µ—Ä —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞ (tests/test_stack.py)
```python
import unittest
from handlers.stack import StackManager

class TestStack(unittest.TestCase):
    def setUp(self):
        self.manager = StackManager(":memory:")
        
    def test_add_product(self):
        self.manager.add_product("Laptop", 10, 1000)
        result = self.manager.get_product(1)
        self.assertEqual(result["name"], "Laptop")
```

## üöÄ –î–µ–ø–ª–æ–π

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker
1. –°–æ–∑–¥–∞–π—Ç–µ `Dockerfile`:
   ```dockerfile
   FROM python:3.10-slim
   WORKDIR /app
   COPY . .
   RUN pip install -r requirements.txt
   CMD ["python", "bot/main.py"]
   ```
2. –°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑:
   ```bash
   docker build -t finance-bot .
   ```
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
   ```bash
   docker run -d --name bot -e BOT_TOKEN="–≤–∞—à_—Ç–æ–∫–µ–Ω" finance-bot
   ```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π
```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
export BOT_TOKEN="–≤–∞—à_—Ç–æ–∫–µ–Ω"
export DB_PATH="/data/finance.db"

# –ó–∞–ø—É—Å–∫
python -m bot.main
```
---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Telegram-–±–æ—Ç–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–ª–∞–¥–æ–º –∏ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏. –î–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –ø–æ–¥ –≤–∞—à–∏ –Ω—É–∂–¥—ã:  
1. –ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î  
2. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤  
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —à–∞–±–ª–æ–Ω—ã –æ—Ç—á–µ—Ç–æ–≤  

---

**–ê–≤—Ç–æ—Ä**: Zertmark  
**–í–µ—Ä—Å–∏—è**: 1.0.0  
**–î–∞—Ç–∞**: 16.05.2025  